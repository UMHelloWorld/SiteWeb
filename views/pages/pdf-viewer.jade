link(rel="stylesheet", type="text/css", href='/static/styles/pages/pdf-viewer.css')
script(src="/static/scripts/pdf/pdf.js")
script(src="http://cdnjs.cloudflare.com/ajax/libs/mathjs/2.2.0/math.min.js")
script.
	PDFJS.workerSrc = '/static/scripts/pdf/pdf.worker.js';
//- script(src='/static/scripts/pdf-viewer.js')
script(src='/static/scripts/pdf-viewer/canvasFunctions.js')
script(src='/static/scripts/pdf-viewer/pdfAppController.js')
script(src='/static/scripts/pdf-viewer/pdfViewerController.js')
script(src='/static/scripts/pdf-viewer/toolboxController.js')
script(src='/static/scripts/pdf-viewer/paint.js')
script(src='/static/scripts/jquery.transform2d.js')
script(src='//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML')
script(type="text/x-mathjax-config").
	MathJax.Hub.Config({
	  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
	});


div(ng-controller='pdf-app')
	div#toolbox(ng-controller='toolbox')
		.item(ng-repeat='action in actions', ng-click='press(action)', ng-class='{active: (isFunction(action.pressed) ? action.pressed() : action.pressed)}')
			i(class='fa fa-{{action.icon}}')
			span {{action.label}}
	div#rightPanel(ng-controller='right-panel', ng-mousemove='resizing && resize($event, true)', ng-mouseup='resizing && finishResize()')
		.resizer(ng-mousedown='resize($event)', ng-mousemove='resizing && resize($event, true)', ng-mouseup='resizing && finishResize()')
		div(ng-show='ableToDrawComment').newComment
			.helper(ng-class='{hide: ableToDrawComment=="composing"}')
				| Pour poser une nouvelle question, cliquez puis glissez votre souris sur le document afin de dessiner la zone sur laquelle votre question porte.
			.content
				.title Poser une nouvelle question
				.about
					.tools(ng-init='activeTool = 0; colors = ["black", "black"];')
						.tool(ng-class='{active: activeTool==0}', ng-style='{color: colors[0]}', ng-click='paint.use(1, "pen", colors[0]);activeTool=0')
							i.fa.fa-pencil
						.tool(ng-class='{active: activeTool==1}', ng-style='{color: colors[1]}', ng-click='paint.use(0.3, "highlighter", colors[1]);activeTool=1')
							i.fa.fa-i-cursor
						.tool(ng-class='{active: activeTool==2}', ng-click='paint.use(1, "eraser");activeTool=2')
							i.fa.fa-eraser
						.colors
							each color, k in ['black', '#f1c40f', '#27ae60', '#d35400']
								.tool(ng-show='activeTool<2', style='color: '+color+';', ng-click='paint.changeColor("'+color+'");colors[activeTool] = "'+color+'"')
									i.fa.fa-square
						.select(ng-init='sizes = [["Ã‰norme", 10], ["Gros", 5], ["Moyen", 2], ["Petit", 1]]; currentSize = 2; isOpen=false;')
							.tool.current(ng-click='isOpen = !isOpen') {{sizes[currentSize][0]}}
							.dropdown.list-group(ng-show='isOpen')
								.tool.list-group-item(ng-repeat='(k, size) in sizes', ng-click='paint.changeSize(size[1]);$parent.currentSize=k;$parent.isOpen=false;')
									i.fa.fa-circle(ng-style='{"font-size": size[1]*1.2}')
									{{size[0]}}
					.place
						div
				.writing
					.white
					textarea(ng-model='description', onkeyup='textAreaAdjust(this)', ng-change='descriptionRefresh()')
					div.render(marked='_description')
				button(ng-click='sendComment(description)') Poser ma question / remarque !
	div#leftPanel(ng-mousemove='resizing && resize($event, true, true)', ng-mouseup='resizing && finishResize()')
		div#pdfArea
			div#pdfPlace(ng-controller='pdf-viewer')
				canvas#pdf(ng-mousedown='(ableToDrawComment===true) && beginAnnotation($event)', ng-mousemove='writingAnnotationMove($event)', ng-mouseup='ableToDrawComment===true && stopAnnotation()')
				//- canvas#makeComment(ng-class='{ableToDrawComment: $parent.ableToDrawComment}')
				#annotations
					div.annotation(
							ng-repeat='annotation in annotations | filter:{show: true}',
							ng-style='getStyleForAnnotation(annotation)',
							ng-show='!$parent.ableToDrawComment || annotation.newOne',
							ng-mousemove='propagate_writingAnnotationMove($event)',
							ng-mousedown='$parent.ableToDrawComment && annotation.newOne && stopAnnotation()',
							ng-mouseup='$parent.ableToDrawComment && annotation.newOne && stopAnnotation()'
						)
				div.comment(
						ng-repeat='area in areas',
						ng-if='displayComments && (+currentPdfPage==+area.page)',
						style='top: {{area.from * 100}}%; height: {{(area.to - area.from)*100}}%;'
					)
					.content
						//- .stuff
							.content
								div(ng-repeat='(k, comment) in area.list',
									ng-mouseover='drawComment(comment)',
									ng-mouseout='clear()')
									| {{+k+1}}) {{(comment.description || "").substr(0, 20)}}...
						.label(
							ng-mouseover='draw(area, "rgba(0, 0, 0, 0.08)", "rgba(0, 0, 0, 0.13)")',
							ng-mouseout='clear()'
						)
							{{area.list.length}}